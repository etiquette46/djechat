<!DOCTYPE html>
<html>
<head>
    <title>Friends | DJEsocials</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav><h1>DJEsocials</h1><ul><li><a href="index.html">Home</a></li><li><a href="friends.html" class="active">Friends</a></li><li><a href="conversations.html">Chats</a></li><li><a href="profile.html">Profile</a></li></ul></nav>

    <div class="container">
        <div class="card">
            <h3>Add Friend by Nickname</h3>
            <input type="text" id="search-nick" placeholder="Enter nickname (no @)...">
            <button id="search-btn">Search</button>
        </div>
        <div id="results"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs, updateDoc, doc, arrayUnion } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDTL2zEm3QrFPs8Mctnx889WH0DcM65nFw", authDomain: "djechat-730a0.firebaseapp.com", projectId: "djechat-730a0", storageBucket: "djechat-730a0.firebasestorage.app", messagingSenderId: "843688111797", appId: "1:843688111797:web:adf9bf0b67f8b3f89e98fc" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        document.getElementById('search-btn').onclick = async () => {
            const nick = document.getElementById('search-nick').value.trim().toLowerCase();
            const q = query(collection(db, "users"), where("nickname", "==", nick));
            const snap = await getDocs(q);
            
            const res = document.getElementById('results');
            res.innerHTML = "";
            if (snap.empty) return res.innerHTML = "No user found.";

            snap.forEach(d => {
                const u = d.data();
                res.innerHTML += `
                    <div class="card" style="display:flex; justify-content:space-between;">
                        <b>@${u.nickname}</b>
                        <button onclick="addF('${u.uid}')">Add Friend</button>
                    </div>`;
            });
        };

        window.addF = async (uid) => {
            await updateDoc(doc(db, "users", auth.currentUser.uid), { friends: arrayUnion(uid) });
            alert("Friend added!");
        };
    </script>
</body>
</html>
